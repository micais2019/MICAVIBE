function msg(e){$("#history").append("<div class='row'>"+e+"</div>")}function showValue(e){console.log("unpack ",e);var n=e.key,o=/ /.test(e.value)?e.value:parseInt(e.value);isNaN(o)&&(o=e.value);var t=$("#"+n);$(".value",t).text(o)}function WebSocketClient(){this.interval=5e3}function startWebsocket(t){msg("connecting to websocket");var e=new WebSocketClient;e.open(window.WS_URL),e.onopen=function(e){$("#indicator").removeClass("disconnected").addClass("connected"),msg("connected")},e.onclose=function(){$("#indicator").addClass("disconnected").removeClass("connected")},e.onerror=e.onclose,e.onmessage=function(e){if(e instanceof Blob){var n=new FileReader;n.onload=function(){var e=JSON.parse(n.result);t?t(e):showValue(e),msg(JSON.stringify(e))},n.readAsText(e)}else if("string"==typeof e){var o=JSON.parse(e);t?t(o):showValue(o),msg(JSON.stringify(o))}}}WebSocketClient.prototype.open=function(e){this.url=e,this.instance=new WebSocket(this.url);var n=this;this.instance.onopen=function(){console.log("[WebSocketClient on open]"),n.onopen()},this.instance.onclose=function(e){switch(console.log("[WebSocketClient on close]"),e.code){case 1e3:console.log("WebSocketClient: closed");break;default:n.reconnect(e)}n.onclose&&n.onclose(e)},this.instance.onerror=function(e){switch(console.log("[WebSocketClient on error]"),e.code){case"ECONNREFUSED":n.reconnect(e);break;default:n.onerror&&n.onerror(e)}},this.instance.onmessage=function(e){console.log("[WebSocketClient on message]"),n.onmessage(e.data)},console.log("[WebSocketClient open] completed")},WebSocketClient.prototype.removeAllListeners=function(){this.instance.onopen=null,this.instance.onclose=null,this.instance.onerror=null,this.instance.onmessage=null},WebSocketClient.prototype.reconnect=function(e){console.log("WebSocketClient: retry in "+this.interval+"ms",e),this.removeAllListeners();var n=this;setTimeout(function(){console.log("WebSocketClient: reconnecting..."),n.open(n.url)},this.interval)};
function openNav(){$("nav").addClass("open")}function closeNav(){$("nav").removeClass("open")}function toggleNav(){$("nav").is(".open")?closeNav():openNav()}
$(function(){startWebsocket(),$("#toggle-history").on("click",function(){var t=$("#history"),o=$("#toggle-history");t.is(":visible")?(o.text("show monitor"),t.hide()):(o.text("hide monitor"),t.show())}),$(".feed-value").on("click",function(t){var o=$(t.target).parent(".feed-value");console.log("evt",t,o.data("link")),o.data("link")&&(document.location.href=o.data("link"))})});