function msg(e){$("#history").append("<div class='row'>"+e+"</div>")}function showValue(e){window.DEBUG&&console.log("unpack ",e);var t=e.key,n=/ /.test(e.value)?e.value:parseInt(e.value);isNaN(n)&&(n=e.value);var o=$("#"+t);$(".value",o).text(n)}function WebSocketClient(){this.interval=1500}function startWebsocket(e){msg("connecting to websocket");var t=new WebSocketClient;t.open(window.WS_URL),t.onopen=function(e){$("#indicator").removeClass("disconnected").addClass("connected"),msg("connected")},t.onclose=function(){$("#indicator").addClass("disconnected").removeClass("connected")},t.onerror=t.onclose,t.onmessage=function(t){if(t instanceof Blob){var n=new FileReader;n.onload=function(){var t=JSON.parse(n.result);e?e(t):(window.Socket.emit("data.*",t),t.key?window.Socket.emit("data."+t.key,{key:t.key,value:t.value,mode:t.mode?t.mode:"live"}):window.Socket.emit("data",t)),msg(JSON.stringify(t))},n.readAsText(t)}else if("string"==typeof t){var o=JSON.parse(t);e?e(o):(window.Socket.emit("data.*",o),o.key?window.Socket.emit("data."+o.key,{key:o.key,value:o.value,mode:o.mode?o.mode:"live"}):window.Socket.emit("data",{message:o})),msg(JSON.stringify(o))}}}function openNav(){$("nav").addClass("open")}function closeNav(){$("nav").removeClass("open")}function toggleNav(){$("nav").is(".open")?closeNav():openNav()}function createProcessingSketch(e,t){return function(n){return new p5(function(o){var i=this,r=function(){i.width=$(n).width(),i.height=$(n).height()};r(),t(i,o),o.windowResized=_.debounce(function(){r(),o.resizeCanvas(i.width,i.height)},300),setTimeout(function(){(Array.isArray(e)?e:[e]).forEach(function(e){window.Socket.on("data."+e,function(e){o.onData&&o.onData(e)})})},75)},n)}}function getBaseLog(e,t){return Math.log(t)/Math.log(e)}!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EventEmitter3=e()}(function(){return function e(t,n,o){function i(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){return i(t[s][1][e]||e)},u,u.exports,e,t,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,i="~";function r(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function c(e,t,n,o,r){if("function"!=typeof n)throw new TypeError("The listener must be a function");var c=new s(n,o||e,r),a=i?i+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],c]:e._events[a].push(c):(e._events[a]=c,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function l(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),l.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},l.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,r=n.length,s=new Array(r);o<r;o++)s[o]=n[o].fn;return s},l.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},l.prototype.emit=function(e,t,n,o,r,s){var c=i?i+e:e;if(!this._events[c])return!1;var a,l,u=this._events[c],f=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),f){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,o),!0;case 5:return u.fn.call(u.context,t,n,o,r),!0;case 6:return u.fn.call(u.context,t,n,o,r,s),!0}for(l=1,a=new Array(f-1);l<f;l++)a[l-1]=arguments[l];u.fn.apply(u.context,a)}else{var h,d=u.length;for(l=0;l<d;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),f){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,n);break;case 4:u[l].fn.call(u[l].context,t,n,o);break;default:if(!a)for(h=1,a=new Array(f-1);h<f;h++)a[h-1]=arguments[h];u[l].fn.apply(u[l].context,a)}}return!0},l.prototype.on=function(e,t,n){return c(this,e,t,n,!1)},l.prototype.once=function(e,t,n){return c(this,e,t,n,!0)},l.prototype.removeListener=function(e,t,n,o){var r=i?i+e:e;if(!this._events[r])return this;if(!t)return a(this,r),this;var s=this._events[r];if(s.fn)s.fn!==t||o&&!s.once||n&&s.context!==n||a(this,r);else{for(var c=0,l=[],u=s.length;c<u;c++)(s[c].fn!==t||o&&!s[c].once||n&&s[c].context!==n)&&l.push(s[c]);l.length?this._events[r]=1===l.length?l[0]:l:a(this,r)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=i,l.EventEmitter=l,void 0!==t&&(t.exports=l)},{}]},{},[1])(1)}),WebSocketClient.prototype.open=function(e){this.url=e,this.instance=new WebSocket(this.url);var t=this;this.instance.onopen=function(){window.DEBUG&&console.log("[WebSocketClient on open]"),t.onopen()},this.instance.onclose=function(e){switch(window.DEBUG&&console.log("[WebSocketClient on close]"),e.code){case 1e3:window.DEBUG&&console.log("WebSocketClient: closed");break;default:t.reconnect(e)}t.onclose&&t.onclose(e)},this.instance.onerror=function(e){switch(window.DEBUG&&console.log("[WebSocketClient on error]"),e.code){case"ECONNREFUSED":t.reconnect(e);break;default:t.onerror&&t.onerror(e)}},this.instance.onmessage=function(e){window.DEBUG&&console.log("[WebSocketClient on message]"),t.onmessage(e.data)},window.DEBUG&&console.log("[WebSocketClient open] completed")},WebSocketClient.prototype.removeAllListeners=function(){this.instance.onopen=null,this.instance.onclose=null,this.instance.onerror=null,this.instance.onmessage=null},WebSocketClient.prototype.reconnect=function(e){window.DEBUG&&console.log("WebSocketClient: retry in",this.interval,"ms",e),this.removeAllListeners();var t=this;setTimeout(function(){window.DEBUG&&console.log("WebSocketClient: reconnecting..."),t.open(t.url)},this.interval)},window.Socket=new EventEmitter3,window.DEBUG=!1,window.log=function(){window.DEBUG&&console.log.apply(console,arguments)},$(function(){startWebsocket(),$("#toggle-history").on("click",function(){var e=$("#history"),t=$("#toggle-history");e.is(":visible")?(t.text("show monitor"),e.hide()):(t.text("hide monitor"),e.show())})}),window.sketches||(window.sketches={}),window.sketches.data=createProcessingSketch("*",function(e,t){var n=[];t.setup=function(){t.createCanvas(e.width,e.height),t.noStroke()},t.draw=function(){t.background(0),n.forEach(function(e,n){var o=t.height/24,i=o*n+o/2;t.fill(0),t.rect(0,i,t.width,50),t.fill(255),t.text(e.key+": "+e.value,10,i)})},t.onData=function(e){n.push(e),n.length>24&&n.shift()},t.drawValue=function(e,n,o){e=Math.floor(currentSpot/24),n=currentSpot-24*e;var i=t.width/xsteps,r=t.height/24;t.fill(0,200,0),t.ellipse(e*i,n*r,30,30),currentSpot=(currentSpot+1)%(24*xsteps)}}),window.sketches.mood=createProcessingSketch("mood",function(e,t){var n=[],o=[[0,192,0],[250,128,0],[234,21,0],[216,0,39],[255,0,0],[108,0,147],[0,64,255],[0,0,150]];t.setup=function(){t.createCanvas(e.width,e.height),t.noStroke(),t.frameRate(4),fetch("https://io.adafruit.com/api/v2/mica_ia/feeds/mood/data?limit=25").then(function(e){return e.json()}).then(function(e){Array.isArray(e)&&e.length>0&&e.forEach(function(e){t.onData(e)})})},t.draw=function(){},t.onData=function(e){if(!e.mode||"reconnect"!==e.mode){e.value.split(" ").forEach(function(e){n.push(parseInt(e))}),t.background(0);for(var i=t.width/n.length;i<4;)n.shift(),i=t.width/n.length;n.forEach(function(e,n){t.fill(o[e]),t.rect(n*i,0,i+1,t.height)})}}}),window.sketches.motion=createProcessingSketch("split-motion",function(e,t){let n=t.color(0,40,255),o=t.color(218,28,0);t.setup=function(){t.createCanvas(e.width,e.height),t.noStroke(),t.frameRate(10)},t.draw=function(){t.fill(0,15),t.rect(0,0,t.width,t.height)},t.onData=function(e){e.value.split(" ").map(function(e){return parseInt(e)}).forEach(function(e,n){var o=Math.floor(n/6),i=n-6*o;t.drawValue(o,i,e)})},t.drawValue=function(e,i,r){var s=t.width/8,c=t.height/6,a=t.lerpColor(n,o,r/127);r>3&&(t.fill(a),t.rect(e*s,i*c,s,c))}});var DX=-1.8;window.sketches.sound=createProcessingSketch(["sound","sound-2"],function(e,t){var n=function(e,t){this.x=e,this.value=t};n.prototype.update=function(){this.x+=DX,this.x<-10&&(this.delete=!0)};var o={sound:{values:[],lastUpdate:0},"sound-2":{values:[],lastUpdate:0}},i=[[],[]];t.setup=function(){t.createCanvas(e.width,e.height),t.noStroke()},t.draw=function(){t.background(0),t.updateBar(o.sound,0),t.updateBar(o["sound-2"],1),t.drawBar(0,0,t.height/2),t.drawBar(1,t.height/2+1,t.height)},t.onData=function(e){e.value.split(" ").map(function(e){return parseInt(e)}).forEach(function(t){isNaN(t)||o[e.key].values.push(t)})};t.updateBar=function(e,o){var r=i[o],s=(t.width,t.millis());if(s-e.lastUpdate>100&&e.values.length>0){var c=e.values.shift();void 0===c||isNaN(c)||r.push(new n(t.width,c)),e.lastUpdate=s}else{r.forEach(function(e){e.update()});for(var a=Math.min(r.length-1,10);a>=0;a--)r[a].delete&&r.splice(a,1)}},t.drawBar=function(e,n,o){var r=i[e],s=t.width/48,c=o-n;r.forEach(function(e){var n=Math.min(Math.max(0,e.value),1e4),i=t.map(n,0,1e4,0,c),r=t.lerpColor(t.color([0,0,150]),t.color([255,28,10]),i/c);t.fill(r),t.rect(e.x,o-i,s+1,i)})}});