function WebSocketClient(){this.reconnect_interval=1500}function startWebsocket(e){var t=new WebSocketClient;t.open(window.WS_URL),t.onopen=function(e){console.log("socket connected")},t.onclose=function(){console.log("socket closed")},t.onerror=t.onclose,t.onmessage=function(t){if(t instanceof Blob){var n=new FileReader;n.onload=function(){var t=JSON.parse(n.result);e?e(t):(window.Socket.emit("data.*",t),t.key?window.Socket.emit("data."+t.key,{key:t.key,value:t.value,mode:t.mode?t.mode:"live"}):window.Socket.emit("data",t))},n.readAsText(t)}else if("string"==typeof t){var o=JSON.parse(t);e?e(o):(window.Socket.emit("data.*",o),o.key?window.Socket.emit("data."+o.key,{key:o.key,value:o.value,mode:o.mode?o.mode:"live"}):window.Socket.emit("data",{message:o}))}}}function openNav(){$("nav").addClass("open")}function closeNav(){$("nav").removeClass("open")}function toggleNav(){$("nav").is(".open")?closeNav():openNav()}function createProcessingSketch(e,t){return function(n){return new p5(function(o){var r=this,i=function(){r.width=$(n).width(),r.height=$(n).height()};i(),t(r,o),o.windowResized=_.debounce(function(){i(),o.resizeCanvas(r.width,r.height)},300),setTimeout(function(){(Array.isArray(e)?e:[e]).forEach(function(e){window.Socket.on("data."+e,function(e){o.onData&&o.onData(e)})})},75)},n)}}function getBaseLog(e,t){return Math.log(t)/Math.log(e)}!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EventEmitter3=e()}(function(){return function e(t,n,o){function r(c,s){if(!n[c]){if(!t[c]){var a="function"==typeof require&&require;if(!s&&a)return a(c,!0);if(i)return i(c,!0);var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[c]={exports:{}};t[c][0].call(u.exports,function(e){return r(t[c][1][e]||e)},u,u.exports,e,t,n,o)}return n[c].exports}for(var i="function"==typeof require&&require,c=0;c<o.length;c++)r(o[c]);return r}({1:[function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function i(){}function c(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new c(n,o||e,i),a=r?r+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],s]:e._events[a].push(s):(e._events[a]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function l(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),l.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},l.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,c=new Array(i);o<i;o++)c[o]=n[o].fn;return c},l.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},l.prototype.emit=function(e,t,n,o,i,c){var s=r?r+e:e;if(!this._events[s])return!1;var a,l,u=this._events[s],f=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),f){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,o),!0;case 5:return u.fn.call(u.context,t,n,o,i),!0;case 6:return u.fn.call(u.context,t,n,o,i,c),!0}for(l=1,a=new Array(f-1);l<f;l++)a[l-1]=arguments[l];u.fn.apply(u.context,a)}else{var h,d=u.length;for(l=0;l<d;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),f){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,n);break;case 4:u[l].fn.call(u[l].context,t,n,o);break;default:if(!a)for(h=1,a=new Array(f-1);h<f;h++)a[h-1]=arguments[h];u[l].fn.apply(u[l].context,a)}}return!0},l.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},l.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},l.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var c=this._events[i];if(c.fn)c.fn!==t||o&&!c.once||n&&c.context!==n||a(this,i);else{for(var s=0,l=[],u=c.length;s<u;s++)(c[s].fn!==t||o&&!c[s].once||n&&c[s].context!==n)&&l.push(c[s]);l.length?this._events[i]=1===l.length?l[0]:l:a(this,i)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,void 0!==t&&(t.exports=l)},{}]},{},[1])(1)}),window.DEBUG=!1,WebSocketClient.prototype.open=function(e){this.url=e,this.instance=new WebSocket(this.url);var t=this;this.instance.onopen=function(){window.DEBUG&&console.log("[WebSocketClient on open]"),t.onopen()},this.instance.onclose=function(e){switch(window.DEBUG&&console.log("[WebSocketClient on close]"),e.code){case 1e3:window.DEBUG&&console.log("WebSocketClient: closed");break;default:t.reconnect(e)}t.onclose&&t.onclose(e)},this.instance.onerror=function(e){switch(window.DEBUG&&console.log("[WebSocketClient on error]"),e.code){case"ECONNREFUSED":t.reconnect(e);break;default:t.onerror&&t.onerror(e)}},this.instance.onmessage=function(e){window.DEBUG&&console.log("[WebSocketClient on message]"),t.onmessage(e.data)},window.DEBUG&&console.log("[WebSocketClient open] completed")},WebSocketClient.prototype.removeAllListeners=function(){this.instance.onopen=null,this.instance.onclose=null,this.instance.onerror=null,this.instance.onmessage=null},WebSocketClient.prototype.reconnect=function(e){window.DEBUG&&console.log("WebSocketClient: retry in",this.reconnect_interval,"ms",e),this.removeAllListeners();var t=this;setTimeout(function(){window.DEBUG&&console.log("WebSocketClient: reconnecting..."),t.open(t.url)},this.reconnect_interval)},window.Socket=new EventEmitter3,$(function(){startWebsocket(),$("#toggle-history").on("click",function(){var e=$("#history"),t=$("#toggle-history");e.is(":visible")?(t.text("show monitor"),e.hide()):(t.text("hide monitor"),e.show())})}),window.sketches||(window.sketches={}),window.sketches.data=createProcessingSketch("*",function(e,t){var n=[];t.setup=function(){t.createCanvas(e.width,e.height),t.noStroke()},t.draw=function(){t.background(0),n.forEach(function(e,n){var o=t.height/24,r=o*n+o/2;t.fill(0),t.rect(0,r,t.width,50),t.fill(255),t.text(e.key+": "+e.value,10,r)})},t.onData=function(e){n.push(e),n.length>24&&n.shift()},t.drawValue=function(e,n,o){e=Math.floor(currentSpot/24),n=currentSpot-24*e;var r=t.width/xsteps,i=t.height/24;t.fill(0,200,0),t.ellipse(e*r,n*i,30,30),currentSpot=(currentSpot+1)%(24*xsteps)}}),window.sketches.mood=createProcessingSketch("mood",function(e,t){var n=[],o=[t.color(0,192,0),t.color(250,128,0),t.color(234,21,0),t.color(216,0,39),t.color(255,0,0),t.color(108,0,147),t.color(0,64,255),t.color(0,0,150)];t.color(100,100,100);t.setup=function(){t.createCanvas(e.width,e.height),t.frameRate(1),fetch("https://io.adafruit.com/api/v2/mica_ia/feeds/mood/data?limit=100").then(function(e){return e.json()}).then(function(e){Array.isArray(e)&&e.length>0&&(e.forEach(function(e){t.onData(e,!1)}),t.drawBars())})},t.draw=function(){t.drawBars(0)},t.onData=function(e,o=!0){if(!e.mode||"reconnect"!==e.mode){for(e.value.split(" ").forEach(function(e){n.push(parseInt(e))});n.length>120;)n.shift();o&&t.drawBars()}},t.drawBars=function(){r()};const r=function(){var e=t.width/n.length;t.noStroke(),n.forEach(function(n,r){t.fill(o[n]),t.rect(r*e,0,e+1,t.height)})}}),window.sketches.motion=createProcessingSketch("split-motion",function(e,t){let n=t.color(0,40,255),o=t.color(218,28,0);t.setup=function(){t.createCanvas(e.width,e.height),t.noStroke(),t.frameRate(10)},t.draw=function(){t.fill(0,15),t.rect(0,0,t.width,t.height)},t.onData=function(e){e.value.split(" ").map(function(e){return parseInt(e)}).forEach(function(e,n){var o=Math.floor(n/6),r=n-6*o;t.drawValue(o,r,e)})},t.drawValue=function(e,r,i){var c=t.width/8,s=t.height/6,a=t.lerpColor(n,o,i/127);i>3&&(t.fill(a),t.rect(e*c,r*s,c,s))}});var DX=-1.8;window.sketches.sound=createProcessingSketch(["sound","sound-2"],function(e,t){var n=function(e,t){this.x=e,this.value=t};n.prototype.update=function(){this.x+=DX,this.x<-10&&(this.delete=!0)};var o={sound:{values:[],lastUpdate:0},"sound-2":{values:[],lastUpdate:0}},r=[[],[]];t.setup=function(){t.createCanvas(e.width,e.height),t.noStroke()},t.draw=function(){t.background(0),t.updateBar(o.sound,0),t.updateBar(o["sound-2"],1),t.drawBar(0,0,t.height/2),t.drawBar(1,t.height/2+1,t.height)},t.onData=function(e){e.value.split(" ").map(function(e){return parseInt(e)}).forEach(function(t){isNaN(t)||o[e.key].values.push(t)})};t.updateBar=function(e,o){var i=r[o],c=(t.width,t.millis());if(c-e.lastUpdate>100&&e.values.length>0){var s=e.values.shift();void 0===s||isNaN(s)||i.push(new n(t.width,s)),e.lastUpdate=c}else{i.forEach(function(e){e.update()});for(var a=Math.min(i.length-1,10);a>=0;a--)i[a].delete&&i.splice(a,1)}},t.drawBar=function(e,n,o){var i=r[e],c=t.width/48,s=o-n;i.forEach(function(e){var n=Math.min(Math.max(0,e.value),1e4),r=t.map(n,0,1e4,0,s),i=t.lerpColor(t.color([0,0,150]),t.color([255,28,10]),r/s);t.fill(i),t.rect(e.x,o-r,c+1,r)})}});